# =============================================
# 0. Основные настройки
# =============================================
set -sg escape-time 0                     # Уменьшение задержки ESC
set -g focus-events on                    # Для плагинов, требующих фокуса
set -g renumber-windows on                # Автоперенумерация окон при закрытии
set -g base-index 1                       # Нумерация окон/панелей с 1
setw -g pane-base-index 1
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# =============================================
# 1. Навигация и управление
# =============================================
# Панели
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind > swap-pane -D       # Сдвинуть панель вправо
bind < swap-pane -U       # Сдвинуть панель влево

# Окна
bind -n M-1 select-window -t 1            # Alt+1 для окна 1
bind -n M-2 select-window -t 2            # Alt+2 для окна 2 и т.д.
bind -n M-0 select-window -t 10           # Alt+0 для окна 10
bind Tab last-window                      # Переключение между последними окнами
bind S choose-tree -s                     # Расширенное меню сессий

# Панели (vi-стиль)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# =============================================
# 2. Внешний вид и статусная строка
# =============================================
# Цветовая схема
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"
set -g pane-active-border-style "fg=#bd93f9"
set -g pane-border-style "fg=#44475a"
set -g message-style "fg=#f8f8f2 bg=#44475a"

# Стиль статусной строки
set -g status-interval 5
set -g status-position bottom
set -g status-style "bg=#282a36 fg=#f8f8f2"

# Левая часть (сессия + окна)
set -g status-left-length 100
set -g status-left "#[fg=#50fa7b,bg=#282a36] 󰆍 #S #[fg=#282a36,bg=#44475a]#[fg=#f8f8f2,bg=#44475a] #I:#W#{?window_flags,#{window_flags}, } #[fg=#44475a,bg=#282a36]"

# Правая часть (системная информация)
set -g status-right-length 150
set -g status-right "#[fg=#44475a,bg=#282a36]#[fg=#8be9fd,bg=#44475a] 󰍛 #{ram_percentage} #[fg=#ffb86c]󰔏 #{cpu_percentage} #[fg=#f1fa8c]󰂄 #{battery_percentage} #[fg=#ff5555]󰑩 #(bash ~/.tmux/get_wg_status.sh) #[fg=#50fa7b]󰥔 %H:%M "

# Стиль окон
setw -g window-status-format "#[fg=#6272a4] #I:#W "
setw -g window-status-current-format "#[fg=#f8f8f2 bg=#44475a] #[fg=#282a36 bg=#f8f8f2]#I:#W#[fg=#f8f8f2 bg=#44475a] "

# =============================================
# 3. Плагины (через tpm)
# =============================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-mem'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-yank'

# Настройки плагинов
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_prefix_prompt '  '
set -g @prefix_highlight_copy_prompt ' 󰆏 '
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @yank_action 'copy-pipe'  # Копировать сразу при отпускании кнопки
# Копирование мышью как в браузере
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "xclip -i -selection clipboard"

# =============================================
# 4. Дополнительные функции
# =============================================
# Копирование в системный буфер (Shift+выделение)
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -i -selection clipboard"

# Быстрое создание окон с названием
bind c new-window -c "#{pane_current_path}" -n " #{pane_current_command}"

# Автосохранение сессий
set -g @continuum-save-interval '15'

# Инициализация плагинов
run '~/.tmux/plugins/tpm/tpm'
